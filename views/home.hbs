<style>
     .collection-cards{
          display: flex;
          flex-wrap: wrap;
          align-items: center;
     }
     .collection-cards .card{
          border: 1px solid #111;
     }
     .collection-cards .card .card-body{
          display: flex;
          flex-direction: column;
          justify-content: center;
          align-items: center;
     }
     .collection-cards .card{
          max-height: 100px;
          margin: 10px;
     }

     .media-card .card{
          margin: 8px;
          max-width: 280px;
          min-height: 200px;
          padding: 0;
     }
     .tv-wrapper .card{
          max-width: 400px;
     }
     .card-body{
          padding: 1.25em;
     }
     .card-body .btn{
          margin-top: 20px;
     }
     .card-body .genres{
          color: #555;
          font-size: 0.8em;
          margin-bottom: 15px;
     }
     .card-title{
          font-size: 0.9em;
          margin-bottom: 0px;
     }
     .card img{
          width: 100%;
     }

</style>
<div class="wrapper search-container">
     <h3 class='title'>Search Movie, Tv</h3>
     <form id='searchForm'>
          <input type="text" id="searchQuery" placeholder="e.g: Mad Max: Fury Road">
          <button type="submit"><img src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4KPCEtLSBHZW5lcmF0b3I6IEFkb2JlIElsbHVzdHJhdG9yIDE5LjAuMCwgU1ZHIEV4cG9ydCBQbHVnLUluIC4gU1ZHIFZlcnNpb246IDYuMDAgQnVpbGQgMCkgIC0tPgo8c3ZnIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHZlcnNpb249IjEuMSIgaWQ9IkxheWVyXzEiIHg9IjBweCIgeT0iMHB4IiB2aWV3Qm94PSIwIDIgOTggOTgiIHN0eWxlPSJlbmFibGUtYmFja2dyb3VuZDpuZXcgMCAyIDk4IDk4OyIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSIgd2lkdGg9IjUxMiIgaGVpZ2h0PSI1MTIiPgo8c3R5bGUgdHlwZT0idGV4dC9jc3MiPgoJLnN0MHtmaWxsOnVybCgjU1ZHSURfMV8pO30KPC9zdHlsZT4KPGxpbmVhckdyYWRpZW50IGlkPSJTVkdJRF8xXyIgZ3JhZGllbnRVbml0cz0idXNlclNwYWNlT25Vc2UiIHgxPSI0OSIgeTE9IjE0LjA5OTkiIHgyPSI0OSIgeTI9Ijg3LjkwMDEiPgoJPHN0b3Agb2Zmc2V0PSIwIiBzdHlsZT0ic3RvcC1jb2xvcjojMDBFRkQxIi8+Cgk8c3RvcCBvZmZzZXQ9IjEiIHN0eWxlPSJzdG9wLWNvbG9yOiMwMEFDRUEiLz4KPC9saW5lYXJHcmFkaWVudD4KPHBhdGggY2xhc3M9InN0MCIgZD0iTTg1LDgyLjhMNjkuNiw2Ny4zYzQuNy01LjYsNy41LTEyLjksNy41LTIwLjdjMC0xNy45LTE0LjYtMzIuNS0zMi41LTMyLjVTMTIuMSwyOC43LDEyLjEsNDYuNiAgczE0LjYsMzIuNSwzMi41LDMyLjVjNy45LDAsMTUuMS0yLjgsMjAuNy03LjVMODAuOCw4N2MwLjYsMC42LDEuNCwwLjksMi4xLDAuOXMxLjUtMC4zLDIuMS0wLjlDODYuMiw4NS45LDg2LjIsODMuOSw4NSw4Mi44eiAgIE0xOC4xLDQ2LjZDMTguMSwzMiwzMCwyMC4xLDQ0LjYsMjAuMWMxNC42LDAsMjYuNSwxMS45LDI2LjUsMjYuNWMwLDE0LjYtMTEuOSwyNi41LTI2LjUsMjYuNUMzMCw3My4xLDE4LjEsNjEuMiwxOC4xLDQ2LjZ6Ii8+Cjwvc3ZnPgo=" /></button>
     </form>
     
     <div class="modal fade" id="searchModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
          <div class="modal-dialog modal-dialog-centered modal-md" role="document">
               <div class="modal-content">
                    <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLongTitle">Search Results</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                         <span aria-hidden="true">&times;</span>
                    </button>
                    </div>
                   <div class="modal-body search-results">
                        <div>No Search Results</div>
                   </div>
               </div>
          </div>
     </div>
          
</div>
{{#if user}}
     <div class='wrapper collections'>
          <h3 >My Collections</h3>
          <div>
               <a href="#" data-toggle="modal" data-target="#createCollectionModal" >Create New Collection</a>
          </div>
          <div class="collection-cards"></div>
          
          <div class="modal fade" id="createCollectionModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
               <div class="modal-dialog modal-dialog-centered modal-md" role="document">
                    <div class="modal-content">
                         <div class="modal-header">
                         <h5 class="modal-title" id="exampleModalLongTitle">Create new collection</h5>
                         <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                              <span aria-hidden="true">&times;</span>
                         </button>
                         </div>
                         <form id="createCollection" onsubmit="createCollection">
                         <div class="modal-body">
                                   <div class="form-group">
                                   <input type="text" class="form-control" name="name" id="name" placeholder="Collection Name">
                              </div>
                              <div class="form-group">
                                   <input type="text" class="form-control" name="description" id="description" placeholder="Collection Descriptiion">
                              </div>
                         </div>
                         <div class="modal-footer">
                              <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                              <input type="submit" class="btn btn-homeprimary" value="Create" />
                         </div>
                         </form>
                    </div>
               </div>
          </div>

          <div class="modal fade" id="collectionModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
               <div class="modal-dialog modal-dialog-centered modal-md" role="document">
                    <div class="modal-content">
                         <div class="modal-header">
                         <h5 class="modal-title" id="exampleModalLongTitle">Collection Name</h5>
                         <div class='modal-overview'></div>
                         <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                              <span aria-hidden="true">&times;</span>
                         </button>
                         </div>
                         <div class="modal-body search-results">

                         </div>
                    </div>
               </div>
          </div>

     </div>
{{/if}}
<div class='wrapper movie-wrapper latest-movies media-card'>
     <h3 >Latest Movies</h3>
     <div class="slider">
     </div>
</div>
<div class='wrapper movie-wrapper popular-movies media-card'>
     <h3 >Popular Movies</h3>
     <div class="slider">
     </div>
</div>
<div class='wrapper tv-wrapper latest-tv media-card'>
     <h3 >Latest Tv</h3>
     <div class="slider">
     </div>
</div>
<div class='wrapper tv-wrapper popular-tv media-card'>
     <h3 >Popular Tv</h3>
     <div class="slider">
     </div>
</div>
<script>

     const setMovieCards = async (url, container)=>{
          let slider = document.querySelector(container)
          const data = await fetchData(url)
          const genres = await fetchData('/genres')
          data.movies.forEach(movie=>{
               let card = document.createElement('div')
               let genre_names = getGenres(movie.genre_ids, genres.genres)
               card.innerHTML = `
                         <div> <img src="https://image.tmdb.org/t/p/original/${movie.backdrop_path}" alt=""> </div>
                         <div class="card-body">
                              <h5 class="card-title">${movie.title} <i>(${movie.release_date.substr(0,4)})</i></h5>
                              <div class='genres'>${genre_names.join(', ')}</div>
                              <div class='overview'>${movie.overview.substr(0,100)}...</div>
                              <a href="/movie/${movie.id}"" class="btn btn-sm btn-success">See More</a>
                         </div>
               `
               card.setAttribute('class','card')
               slider.appendChild(card)
          })
     }
      const setTvCards = async (url, container)=>{
          let slider = document.querySelector(container)
          const data = await fetchData(url)
          const genres = await fetchData('/genres')
          data.tvs.forEach(tv=>{
               let card = document.createElement('div')
               let genre_names = getGenres(tv.genre_ids, genres.genres)
               card.innerHTML = `
                    <div> <img src="https://image.tmdb.org/t/p/original/${tv.backdrop_path}" alt=""> </div>
                    <div class="card-body">
                              <h5 class="card-title">${tv.original_name} <i>(${tv.first_air_date.substr(0,4)})</i></h5>
                              <div class='genres'>${genre_names.join(', ')}</div>
                              <div class='overview'>${tv.overview.substr(0,100)}...</div>
                              <a href="/tv/${tv.id}"" class="btn btn-sm btn-success">See More</a>
                         </div>
               `
               card.setAttribute('class','card')
               slider.appendChild(card)
          })
     }

     setSlider(setMovieCards , '/movie/now_playing', '.latest-movies .slider')   
     setSlider(setMovieCards , '/movie/popular', '.popular-movies .slider')   
     setSlider(setTvCards , '/tv/on_the_air', '.latest-tv .slider')   
     setSlider(setTvCards , '/tv/popular', '.popular-tv .slider')   
     
     let createCollection = async (e)=>{
          e.preventDefault()
          let collection = {
               name: createCollectionForm.name.value,
               description: createCollectionForm.description.value
          }
          let response = await fetch('/create-collection', {
               method: 'POST',
               body: JSON.stringify(collection),
               headers: {
                    'Content-Type': 'application/json',
               },
          })
          const  data = await response.json();
          let createCollectionModal = document.getElementById('createCollectionModal')
          $('#createCollectionModal').modal('hide')
          setCollectionCards()
     }
     
     const setCollectionCards = async ()=>{
          let collectionCards = document.querySelector('.collection-cards')
          collectionCards.innerHTML=""
          const data = await fetchData('/get-collections')
          if(data.length<=0){
               collectionCards.innerHTML=`
                              <div>
                                   <span>No Collections,</span>
                                   <a href="#" data-toggle="modal" data-target="#createCollectionModal" >Create New Collection</a>
                              </div>`
               return
          }
          data.collections.forEach(collection=>{
               let card = document.createElement('div')
               card.innerHTML = `
                    <div class="card-body">
                              <h5 class="card-title">${collection.name}</h5>
                              <p>${collection.description}</p>
                         </div>
               `
               card.setAttribute('class','card')
               collectionCards.appendChild(card)
               card.onclick = ()=>{
                    $('#collectionModal').modal('show')
                    const collectionModal  = document.getElementById('collectionModal')
                    let title = document.querySelector('#collectionModal .modal-title')
                    title.innerHTML = `${collection.name}`
                    let container = document.querySelector('#collectionModal .modal-body')
                    container.innerHTML = ""
                    collection.movies.forEach(async id=>{
                         let {movie} = await fetchData(`/movie/id/${id}`)
                         let card = document.createElement('div')
                         card.innerHTML = `
                                   <img src="https://image.tmdb.org/t/p/w200/${movie.poster_path}" alt="">
                                   <div>
                                        <h5 class='card-title'><a href="/movie/${movie.id}">${movie.original_title}</a></h5>
                                        <div class="card-overview">${movie.overview.substr(0,100)}...</div>
                                   </div>
                         `
                         container.appendChild(card)
                    })
               }
          })
     }

     setCollectionCards()  

     const searchForm = document.getElementById('searchForm')
     searchForm.onsubmit = async (e)=>{
          e.preventDefault();
          const searchModal = document.getElementById('searchModal')
          let query = document.getElementById("searchQuery").value
          
          let response = await fetch(`/search/${query}`)

          const  data = await response.json();

          $(searchModal).modal('show');

          let container = document.querySelector('.search-results')
          if(data.results.length>0)
               container.innerHTML = ''
          data.results.forEach(result=>{
               let card = document.createElement('div')
               card.innerHTML = `
                         <img src="https://image.tmdb.org/t/p/w200/${result.poster_path}" alt="">
                         <div>
                              <h5 class='card-title'><a href="/movie/${result.id}">${result.original_title}</a></h5>
                              <div class="card-overview">${result.overview.substr(0,100)}...</div>
                         </div>
               `
               container.appendChild(card)
          })

     }

</script>